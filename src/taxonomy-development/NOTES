perl -MBio::LITE::Taxonomy::NCBI -Mautodie -e 'BEGIN{$Tax = Bio::LITE::Taxonomy::NCBI->new(names=>"names.dmp",nodes=>"nodes.dmp");} for my $fasta(glob("../../../Kalamari_v3.9/library/added/*.fna")){open(my $fh, $fasta); my $header = <$fh>; close $fh; chomp($header); my($name, undef, $taxid) = split(/\|/,$header); my $lineage = $Tax->get_taxonomy($taxid); $savedNames{$_}=1 for(@$lineage); } END{for $name(keys(%savedNames)){ $taxids{$Tax->get_taxid_from_name($name)} = 1; } for $taxid(sort {$a<=>$b} keys(%taxids)){print "$taxid\n";} }'

# be sure to copy/paste the tab appropriately
perl -MBio::LITE::Taxonomy::NCBI -Mautodie -e 'BEGIN{$Tax = Bio::LITE::Taxonomy::NCBI->new(names=>"names.dmp",nodes=>"nodes.dmp");} for my $fasta(glob("../../../Kalamari_v3.9/library/added/*.fna")){open(my $fh, $fasta); my $header = <$fh>; close $fh; chomp($header); my($name, undef, $taxid) = split(/\|/,$header); my $lineage = $Tax->get_taxonomy($taxid); $taxids{$Tax->get_taxid_from_name($_)}=1 for(@$lineage); $taxids{$taxid}=1; } END{for $taxid(sort {$a<=>$b} keys(%taxids)){print "$taxid\n";} }' | xargs -P 1 -n 1 bash -c 'echo -ne . >&2; grep "^$0       " names.dmp' > names.reduced.dmp
